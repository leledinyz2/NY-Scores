<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>NYSCORES - LeleNY</title>
  <style>
    :root {
  --bg1: #0a0e14;
  --bg2: #101726;
  --card: #131b2d;
  --accent1: #4fc4ff;
  --accent2: #8ae2ff;
  --accentGlow: rgba(80, 180, 255, 0.45);
  --text: #e9f3ff;
  --muted: #9ab0c7;
}

/* fundo com degradê suave + shapes */
body {
  margin: 0;
  font-family: Inter, system-ui, sans-serif;
  background: radial-gradient(circle at 20% 20%, #111a2b, #0a0e14 60%);
  color: var(--text);
  overflow-x: hidden;
}

body::before,
body::after {
  content: "";
  position: fixed;
  width: 500px;
  height: 500px;
  background: var(--accentGlow);
  filter: blur(140px);
  z-index: -1;
  opacity: 0.4;
}

body::before {
  top: -100px;
  left: -100px;
}

body::after {
  bottom: -100px;
  right: -100px;
}

/* header estilo material */
header {
  background: linear-gradient(135deg, var(--accent1), var(--accent2));
  padding: 16px 20px;
  font-size: 20px;
  font-weight: 700;
  text-align: center;
  color: #0a0e14;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 0 25px var(--accentGlow);
}

/* container */
.wrap {
  max-width: 1100px;
  margin: 20px auto;
  padding: 16px;
}

/* cartão material */
.card {
  background: linear-gradient(145deg, var(--card), var(--bg2));
  border-radius: 18px;
  padding: 18px;
  box-shadow: 0 10px 28px rgba(0, 0, 0, 0.6),
              0 0 35px rgba(80, 160, 255, 0.16);
  border: 1px solid rgba(255,255,255,0.05);
  position: relative;
}

/* brilho de borda */
.card::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 18px;
  padding: 1px;
  background: linear-gradient(135deg, var(--accent1), transparent 60%);
  -webkit-mask: 
      linear-gradient(#fff 0 0) content-box, 
      linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  pointer-events: none;
}

/* inputs e selects */
input, select, textarea {
  background: #0f1524;
  border: 1px solid rgba(255,255,255,0.08);
  color: var(--text);
  padding: 10px;
  border-radius: 12px;
  font-size: 14px;
  box-shadow: inset 0 0 12px rgba(0,0,0,0.4);
  transition: 0.2s;
}

input:focus, select:focus, textarea:focus {
  border-color: var(--accent1);
  box-shadow: 0 0 12px var(--accentGlow);
  outline: none;
}

/* botões */
.btn {
  background: linear-gradient(135deg, var(--accent1), var(--accent2));
  color: #0a0e14;
  border: none;
  padding: 10px 14px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.15s;
  box-shadow: 0 6px 18px var(--accentGlow);
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 22px var(--accentGlow);
}

.btn.ghost {
  background: rgba(255,255,255,0.07);
  color: var(--muted);
  border: 1px solid rgba(255,255,255,0.08);
}

/* tabela */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 12px;
  font-size: 14px;
}

th {
  color: var(--muted);
  font-weight: 600;
  padding: 10px;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

td {
  padding: 10px;
}

tr:hover {
  background: rgba(255,255,255,0.04);
}

/* texto apagado */
.muted {
  color: var(--muted);
}

/* responsivo */
@media (max-width: 760px) {
  form {
    flex-direction: column !important;
  }
}
  </style>
</head>
<body>
  <header>Criador de Pontuações — Monta sua ficha do zero</header>
  <div class="wrap">
    <div class="card">
      <h3 style="margin:4px 0 8px 0">Adicionar música</h3>
      <form id="formNova">
        <input id="inputMusica" class="grow" placeholder="Nome da música (obrigatório)" required>
        <input id="inputVersao" placeholder="Versão (ex: Club, Remix)" style="width:180px">
        <input id="inputPontuacao" type="number" min="0" placeholder="Pontuação" style="width:120px">
        <select id="inputEstrelas">
          <option value="">Estrelas</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>

        <div class="controls">
          <button type="submit" class="btn">Adicionar</button>
          <button type="button" id="limparForm" class="btn ghost small">Limpar</button>
        </div>
      </form>

      <div style="margin-top:12px" class="muted">Os dados são salvos localmente no seu navegador (localStorage). Você pode exportar como CSV/JSON para compartilhar ou importar de volta.</div>
    </div>

    <div class="card" style="margin-top:14px">
      <div class="flex" style="justify-content:space-between">
        <h3 style="margin:6px 0">Sua lista</h3>
        <div class="actions">
          <button id="exportJson" class="btn small">Exportar JSON</button>
          <button id="exportCsv" class="btn small">Exportar CSV</button>
          <label class="btn small ghost" style="display:inline-block;cursor:pointer">
            Importar JSON<input id="importFile" type="file" accept="application/json" style="display:none">
          </label>
          <button id="copyUrl" class="btn small ghost">Gerar link (copiar)</button>
          <button id="clearAll" class="btn ghost small">Limpar tudo</button>
        </div>
      </div>

      <table id="tabela">
        <thead>
          <tr><th>Música</th><th>Versão</th><th>Pontuação</th><th>Estrelas</th><th></th></tr>
        </thead>
        <tbody id="tbody">
          <tr class="empty"><td colspan="6">Nenhuma música adicionada. Use o formulário acima para criar sua ficha.</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // storage key
    const STORAGE_KEY = 'jd_custom_sheet_v1';

    // DOM
    const form = document.getElementById('formNova');
    const inputMusica = document.getElementById('inputMusica');
    const inputVersao = document.getElementById('inputVersao');
    const inputPontuacao = document.getElementById('inputPontuacao');
    const inputEstrelas = document.getElementById('inputEstrelas');
    const tbody = document.getElementById('tbody');
    const exportJsonBtn = document.getElementById('exportJson');
    const exportCsvBtn = document.getElementById('exportCsv');
    const importFile = document.getElementById('importFile');
    const copyUrlBtn = document.getElementById('copyUrl');
    const clearAllBtn = document.getElementById('clearAll');
    const limparFormBtn = document.getElementById('limparForm');

    let dados = [];

    // util
    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(dados)); }
    function load(){ try{ const raw = localStorage.getItem(STORAGE_KEY); dados = raw? JSON.parse(raw): []; }catch(e){ dados=[] } }

    function render(){
      tbody.innerHTML = '';
      if(dados.length===0){ tbody.innerHTML = '<tr class="empty"><td colspan="6">Nenhuma música adicionada. Use o formulário acima para criar sua ficha.</td></tr>'; return; }
      dados.forEach((item,idx)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${escapeHtml(item.musica)}</td>
          <td>${escapeHtml(item.versao||'')}</td>
          <td>${escapeHtml(item.pontuacao||'')}</td>
          <td>${escapeHtml(item.estrelas||'')}</td>
          <td style="text-align:right">
            <button class="btn small ghost" data-idx="${idx}" data-action="edit">Editar</button>
            <button class="btn small ghost" data-idx="${idx}" data-action="del">Excluir</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    form.addEventListener('submit', e=>{
      e.preventDefault();
      const musica = inputMusica.value.trim();
      if(!musica) return alert('Coloca o nome da música!');
      const item = {
  musica: musicaInput.value,
  versao: versaoInput.value,
  pontuacao: Number(pontuacaoInput.value),
  estrelas: estrelasInput.value
};
      dados.push(item); save(); render(); form.reset(); inputMusica.focus();
    });

    limparFormBtn.addEventListener('click', ()=>{ form.reset(); inputMusica.focus(); });

    tbody.addEventListener('click', e=>{
      const btn = e.target.closest('button'); if(!btn) return;
      const idx = Number(btn.getAttribute('data-idx'));
      const action = btn.getAttribute('data-action');
      if(action==='del'){
        if(!confirm('Excluir esta música?')) return;
        dados.splice(idx,1); save(); render();
      }else if(action==='edit'){
        const it = dados[idx];
        inputMusica.value = it.musica; inputVersao.value = it.versao; inputPontuacao.value = it.pontuacao; inputEstrelas.value = it.estrelas;
        // remove original and allow resubmit
        dados.splice(idx,1); save(); render(); inputMusica.focus();
      }
    });

    // export JSON
    exportJsonBtn.addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(dados, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'jd_scores.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    // export CSV
    function toCSV(arr){
      if(!arr.length) return ''; const headers = ['Música','Versão','Pontuação','Estrelas'];
      const esc = v => '"'+String(v||'').replace(/"/g,'""')+'"';
      const lines = [headers.map(esc).join(',')];
      arr.forEach(r=> lines.push([r.musica,r.versao,r.pontuacao,r.estrelas].map(esc).join(',')));
      return lines.join('\n');
    }
    exportCsvBtn.addEventListener('click', ()=>{
      const csv = toCSV(dados);
      const blob = new Blob([csv], {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'jd_scores.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    // import JSON
    importFile.addEventListener('change', e=>{
      const f = e.target.files[0]; if(!f) return; const reader = new FileReader();
      reader.onload = ev => {
        try{ const parsed = JSON.parse(ev.target.result); if(!Array.isArray(parsed)) throw new Error('Formato inválido');
          // normalize
          parsed.forEach(it=>{ it.musica = it.musica||it.Música||it.song||''; it.versao = it.versao||it.Versão||it.version||''; it.pontuacao = it.pontuacao||it.Pontuação||it.score||''; it.estrelas = it.estrelas||it.Estrelas||''; });
          dados = parsed.filter(x=>x.musica && x.musica.trim()!==''); save(); render();
        }catch(err){ alert('Erro ao importar JSON: '+err.message); }
      };
      reader.readAsText(f);
      e.target.value = '';
    });

    // copy as shareable URL (data encoded in URL hash)
    copyUrlBtn.addEventListener('click', ()=>{
      const payload = encodeURIComponent(JSON.stringify(dados));
      const url = location.origin + location.pathname + '#data=' + payload;
      navigator.clipboard.writeText(url).then(()=> alert('Link copiado! Cola onde quiser para compartilhar (dados ficam no link).'))
        .catch(()=> alert('Não foi possível copiar. Exporta o JSON em vez disso.'));
    });

    // clear all
    clearAllBtn.addEventListener('click', ()=>{ if(confirm('Limpar toda a lista?')){ dados=[]; save(); render(); } });

    // load from URL hash (import via link)
    function loadFromHash(){
      if(location.hash && location.hash.startsWith('#data=')){
        try{ const raw = decodeURIComponent(location.hash.slice(6)); const parsed = JSON.parse(raw); if(Array.isArray(parsed)){ dados = parsed; save(); render(); setTimeout(()=>alert('Dados importados do link!'),200); }
        }catch(e){ console.warn('hash import falhou', e); }
      }
    }

    // init
    load(); loadFromHash(); render();
  </script>
  <div class="loader-section">
    <h2>Carregar dados de uma planilha</h2>
    <input id="sheetUrl" type="text" placeholder="Cole aqui o link da planilha CSV ou Google Sheets (CSV)">
    <button id="loadSheet">Carregar</button>
  </div>
  <script>
// ----- IMPORTAR VIA PLANILHA (CSV) -----

async function loadFromURL(url){
  try{
    const response = await fetch(url);
    const text = await response.text();

    console.log("CSV recebido:", text);

    const rows = text
      .split(/\r?\n/)
      .map(r => r.split(","))
      .filter(r => r.some(x => x.trim() !== ""));

    if(rows.length <= 1){
      alert("Planilha vazia ou inválida.");
      return;
    }

    // Remove cabeçalho
    rows.shift();

    rows.forEach(r=>{
      const item = {
  musica: r[0] ? r[0].trim() : "",
  versao: r[1] ? r[1].trim() : "",
  pontuacao: r[2] ? Number(r[2].trim()) : "",
  estrelas: r[3] ? r[3].trim() : ""
      };

      if(item.musica !== ""){
        dados.push(item);
      }
    });

    save();
    render();
    alert("Planilha carregada com sucesso!");
    
  }catch(err){
    alert("Erro ao carregar: " + err.message);
    console.error(err);
  }
}

document.getElementById("loadSheet").onclick = ()=>{
  const url = document.getElementById("sheetUrl").value.trim();
  if(!url){
    alert("Cole um link primeiro!");
    return;
  }
  loadFromURL(url);
};
</script>
</body>
</html>
